<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Data App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .main-container { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; margin-bottom: 30px; border-top: 5px solid #1a73e8; }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 25px; }

        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input[type="text"], input[type="email"], select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; box-sizing: border-box; transition: 0.3s; }
        input:focus, select:focus { border-color: #1a73e8; outline: none; }
        .input-group-container { display: flex; gap: 10px; }
        .input-wrapper { flex: 1; position: relative; }

        .btn-tool { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; flex-shrink: 0; transition: 0.2s; }
        .btn-enrich { background-color: #1a73e8; } .btn-enrich:hover { background-color: #155db5; }
        .btn-map { background-color: #ea4335; } .btn-map:hover { background-color: #c5221f; }
        
        #suggestions-list { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e0e0e0; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .suggestion-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .suggestion-item:hover { background: #f5faff; }
        
        .specialty-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px; }
        .radio-label { display: flex; align-items: center; cursor: pointer; font-size: 13px; background: #f8f9fa; padding: 8px 12px; border-radius: 20px; border: 1px solid #dee2e6; transition: background 0.2s; }
        .radio-label:hover { background: #e9ecef; }
        input[type="radio"]:checked + span { font-weight: bold; color: #1a73e8; }
        input[type="radio"] { margin-right: 8px; }

        .btn-submit { width: 100%; padding: 14px; background-color: #34a853; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-submit:hover { background-color: #2c8f45; }
        .btn-cancel { width: 100%; padding: 14px; background-color: #f44336; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; display: none; }

        .public-sector-toggle { margin-bottom: 15px; background: #e8f0fe; padding: 10px; border-radius: 8px; display: flex; align-items: center; cursor: pointer; border: 1px solid #d2e3fc; }
        .public-sector-toggle input { margin-right: 10px; transform: scale(1.3); }
        .public-sector-fields { display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 15px; }
        
        .schedule-grid { display: grid; grid-template-columns: 80px 1fr; gap: 10px; align-items: center; margin-bottom: 8px; }
        .schedule-grid label { margin: 0; font-weight: normal; font-size: 14px; }
        
        /* Î£Ï„Ï…Î» Î³Î¹Î± Ï„Î± Select2 Dropdowns */
        .select2-container { width: 100% !important; }
        .select2-selection { border: 2px solid #e0e0e0 !important; border-radius: 8px !important; height: 42px !important; display: flex !important; align-items: center !important; }
        .select2-selection__arrow { height: 40px !important; }

        .db-container { width: 100%; max-width: 600px; margin-top: 20px; }
        .doctor-card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid #1a73e8; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }
        .doc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .doc-header h3 { margin: 0; font-size: 16px; color: #333; }
        .doc-spec { font-size: 13px; background: #e8f0fe; color: #1a73e8; padding: 2px 8px; border-radius: 10px; font-weight: 600; }
        .doc-details p { margin: 3px 0; font-size: 14px; color: #555; }
        .doc-details i { width: 20px; color: #888; text-align: center; }
        .map-link { text-decoration: none; color: #555; transition: color 0.2s; }
        .map-link:hover { color: #ea4335; font-weight: 500; }
        .map-link i { color: #ea4335; }
        .edit-btn { position: absolute; top: 15px; right: 15px; background: white; border: 1px solid #ccc; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #555; }
        .edit-btn:hover { background: #1a73e8; color: white; border-color: #1a73e8; }
        .refresh-btn { background: none; border: none; color: #1a73e8; cursor: pointer; font-weight: bold; margin-bottom: 10px; float: right; }
        .fa-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>
<body>

<div class="main-container">
    <h2 id="formTitle"><i class="fas fa-user-md"></i> ÎÎ­Î¿Ï‚ Î™Î±Ï„ÏÏŒÏ‚</h2>

    <div class="form-group">
        <label>ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿</label>
        <div class="input-group-container">
            <div class="input-wrapper">
                <input type="text" id="nameInput" placeholder="Ï€.Ï‡. Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚ Î“ÎµÏÏÎ³Î¹Î¿Ï‚" autocomplete="off">
            </div>
            <button id="btnEnrich" class="btn-tool btn-enrich" title="Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· Î±Ï€ÏŒ Î•Ï€Î±Ï†Î­Ï‚"><i class="fas fa-cloud-download-alt"></i></button>
        </div>
    </div>

    <div class="form-group">
        <label>Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Î™Î±Ï„ÏÎµÎ¯Î¿Ï…</label>
        <div class="input-group-container">
            <div class="input-wrapper">
                <input type="text" id="addressInput" placeholder="Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÏÏÎµÏƒÎ·...">
            </div>
            <button id="btnMapSearch" class="btn-tool btn-map" title="Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÏÏÎµÏƒÎ· Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ (API)"><i class="fas fa-map-marker-alt"></i></button>
        </div>
    </div>

    <div class="input-group-container form-group">
        <div class="input-wrapper">
            <label>ÎšÎ¹Î½Î·Ï„ÏŒ</label>
            <input type="text" id="mobileInput" placeholder="69...">
        </div>
        <div class="input-wrapper">
            <label>Î£Ï„Î±Î¸ÎµÏÏŒ</label>
            <input type="text" id="landlineInput" placeholder="210...">
        </div>
    </div>

    <div class="form-group">
        <label>Email</label>
        <input type="email" id="emailInput">
    </div>

    <div class="form-group">
        <label>Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±</label>
        <div class="specialty-container">
            <label class="radio-label"><input type="radio" name="specialty" value="Î“ÎµÎ½Î¹ÎºÏŒÏ‚ Î™Î±Ï„ÏÏŒÏ‚"> <span>Î“ÎµÎ½Î¹ÎºÏŒÏ‚ Î™Î±Ï„ÏÏŒÏ‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="ÎšÎ±ÏÎ´Î¹Î¿Î»ÏŒÎ³Î¿Ï‚"> <span>ÎšÎ±ÏÎ´Î¹Î¿Î»ÏŒÎ³Î¿Ï‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î“ÎµÎ½. Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³ÏŒÏ‚"> <span>Î“ÎµÎ½. Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³ÏŒÏ‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î‘Î³Î³ÎµÎ¹Î¿Î»ÏŒÎ³Î¿Ï‚ /Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³ÏŒÏ‚"> <span>Î‘Î³Î³ÎµÎ¹Î¿Î»ÏŒÎ³Î¿Ï‚ /Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³ÏŒÏ‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î Î½ÎµÏ…Î¼Î¿Î½Î¿Î»ÏŒÎ³Î¿Ï‚"> <span>Î Î½ÎµÏ…Î¼Î¿Î½Î¿Î»ÏŒÎ³Î¿Ï‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î Î±Î¸Î¿Î»ÏŒÎ³Î¿Ï‚"> <span>Î Î±Î¸Î¿Î»ÏŒÎ³Î¿Ï‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="ÎŸÏÎ¸Î¿Ï€ÎµÎ´Î¹ÎºÏŒÏ‚"> <span>ÎŸÏÎ¸Î¿Ï€ÎµÎ´Î¹ÎºÏŒÏ‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î“Ï…Î½Î±Î¹ÎºÎ¿Î»ÏŒÎ³Î¿Ï‚"> <span>Î“Ï…Î½Î±Î¹ÎºÎ¿Î»ÏŒÎ³Î¿Ï‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î†Î»Î»Î¿" id="radioOther"> <span>Î†Î»Î»Î¿</span></label>
        </div>
        <input type="text" id="specialtyText" placeholder="Î“ÏÎ¬ÏˆÏ„Îµ Ï„Î·Î½ ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±..." style="margin-top:10px; display:none; width:100%;">
    </div>

    <div class="public-sector-toggle">
        <label style="margin:0; width:100%; cursor:pointer; display:flex; align-items:center;">
            <input type="checkbox" id="publicSectorCheck"> ğŸ¥ Î™Î±Ï„ÏÏŒÏ‚ Î”Î·Î¼Î¿ÏƒÎ¯Î¿Ï… (ÎÎ¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¯Î¿ / Îš.Î¥.)
        </label>
    </div>

    <div id="publicSectorFields" class="public-sector-fields">
        <div class="form-group">
            <label>ÎŸÏÎ³Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ (ÎÎ¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¯Î¿ / ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚)</label>
            <select id="affiliationInput" class="select2-search">
                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ...</option>
                <optgroup label="ÎÎ¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¯Î±">
                    <option value="Î“ÎµÎ½Î¹ÎºÏŒ ÎÎ¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¯Î¿ ÎˆÎ´ÎµÏƒÏƒÎ±Ï‚">Î“ÎµÎ½Î¹ÎºÏŒ ÎÎ¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¯Î¿ ÎˆÎ´ÎµÏƒÏƒÎ±Ï‚</option>
                    <option value="Î“ÎµÎ½Î¹ÎºÏŒ ÎÎ¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¯Î¿ Î“Î¹Î±Î½Î½Î¹Ï„ÏƒÏÎ½">Î“ÎµÎ½Î¹ÎºÏŒ ÎÎ¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¯Î¿ Î“Î¹Î±Î½Î½Î¹Ï„ÏƒÏÎ½</option>
                </optgroup>
                <optgroup label="ÎšÎ­Î½Ï„ÏÎ± Î¥Î³ÎµÎ¯Î±Ï‚">
                    <option value="ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚ Î‘ÏÎ¹Î´Î±Î¯Î±Ï‚">ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚ Î‘ÏÎ¹Î´Î±Î¯Î±Ï‚</option>
                    <option value="ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚ Î£ÎºÏÎ´ÏÎ±Ï‚">ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚ Î£ÎºÏÎ´ÏÎ±Ï‚</option>
                    <option value="ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚ ÎšÏÏÎ±Ï‚ Î’ÏÏÏƒÎ·Ï‚">ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚ ÎšÏÏÎ±Ï‚ Î’ÏÏÏƒÎ·Ï‚</option>
                    <option value="ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚ Î†ÏÎ½Î¹ÏƒÏƒÎ±Ï‚">ÎšÎ­Î½Ï„ÏÎ¿ Î¥Î³ÎµÎ¯Î±Ï‚ Î†ÏÎ½Î¹ÏƒÏƒÎ±Ï‚</option>
                </optgroup>
            </select>
        </div>
        
        <label style="margin-bottom:10px;">ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î•Ï€Î¹ÏƒÎºÎ­ÏˆÎµÏ‰Î½ ÏƒÏ„Î± Î§Ï‰ÏÎ¹Î¬ (Î. Î Î­Î»Î»Î±Ï‚):</label>
        <div class="schedule-grid"><label>Î”ÎµÏ…Ï„Î­ÏÎ±:</label><select id="villageMon" class="select2-search village-select"><option value="">-</option></select></div>
        <div class="schedule-grid"><label>Î¤ÏÎ¯Ï„Î·:</label><select id="villageTue" class="select2-search village-select"><option value="">-</option></select></div>
        <div class="schedule-grid"><label>Î¤ÎµÏ„Î¬ÏÏ„Î·:</label><select id="villageWed" class="select2-search village-select"><option value="">-</option></select></div>
        <div class="schedule-grid"><label>Î Î­Î¼Ï€Ï„Î·:</label><select id="villageThu" class="select2-search village-select"><option value="">-</option></select></div>
        <div class="schedule-grid"><label>Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®:</label><select id="villageFri" class="select2-search village-select"><option value="">-</option></select></div>
    </div>

    <input type="hidden" id="notesInput">
    
    <button class="btn-submit" id="submitBtn">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î™Î±Ï„ÏÎ¿Ï</button>
    <button class="btn-cancel" id="cancelBtn" onclick="resetEditing()">Î‘ÎºÏÏÏ‰ÏƒÎ· Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚</button>
</div>

<div class="db-container">
    <div style="overflow: hidden; margin-bottom: 10px;">
        <h3 style="float:left; margin:0;">ğŸ—‚ï¸ Î’Î¬ÏƒÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</h3>
        <button class="refresh-btn" onclick="loadDoctors()">ğŸ”„ Î‘Î½Î±Î½Î­Ï‰ÏƒÎ·</button>
    </div>
    <div id="doctorsListLoader" style="display:none; text-align:center; padding:20px;"><i class="fas fa-spinner fa-2x"></i></div>
    <div id="doctorsListContainer"></div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbztdWp7vOsB12PChcZyklXSHCBzGQJZfs6tRhksvXvW6rNp55uC-165EREw0gukjXmR/exec";
    let editingId = null;

    // --- Î›Î™Î£Î¤Î‘ Î§Î©Î¡Î™Î©Î ÎÎŸÎœÎŸÎ¥ Î Î•Î›Î›Î‘Î£ ---
    const PELLA_VILLAGES = [
        "Î‘Î³Î¬Î¸Î·", "Î‘Î³Î¯Î± Î¦Ï‰Ï„ÎµÎ¹Î½Î®", "Î†Î³Î¹Î¿Ï‚ Î‘Î¸Î±Î½Î¬ÏƒÎ¹Î¿Ï‚", "Î†Î³Î¹Î¿Ï‚ Î”Î·Î¼Î®Ï„ÏÎ¹Î¿Ï‚", "Î†Î³Î¹Î¿Ï‚ Î›Î¿Ï…ÎºÎ¬Ï‚", "Î†Î³Î¹Î¿Ï‚ Î Î±Î½Ï„ÎµÎ»ÎµÎ®Î¼Î¿Î½Î±Ï‚", "Î†Î³ÏÎ±Ï‚", "Î‘ÎµÏ„Î¿Ï‡ÏÏÎ¹", "Î‘Î¸ÏÏÎ±", "Î‘ÎºÏÎ¿Î»Î¯Î¼Î½Î·", "Î†Î»Ï‰ÏÎ¿Ï‚", "Î‘Î¼Ï€ÎµÎ»ÎµÎ¹Î­Ï‚", "Î†Î½Ï…Î´ÏÎ¿", "Î‘Î¾ÏŒÏ‚", "Î‘ÏÎ±Î²Î·ÏƒÏƒÏŒÏ‚", "Î†ÏÎ³Î¹ÏƒÏƒÎ±", "Î‘ÏÎ¹Î´Î±Î¯Î±", "Î†ÏÎ½Î¹ÏƒÏƒÎ±", "Î‘ÏÏ‡Î¬Î³Î³ÎµÎ»Î¿Ï‚", "Î†ÏƒÏ€ÏÎ¿", "Î‘Ï‡Î»Î±Î´Î¿Ï‡ÏÏÎ¹", "Î†ÏˆÎ±Î»Î¿Ï‚",
        "Î’Î¿ÏÎµÎ¹Î½ÏŒ", "Î’ÏÏ…Ï„Ï„Î¬",
        "Î“Î±Î»Î±Ï„Î¬Î´ÎµÏ‚", "Î“Î±ÏÎ­Ï†Î¹", "Î“Î¹Î±Î½Î½Î¹Ï„ÏƒÎ¬", "Î“ÏÎ±Î¼Î¼Î±Ï„Î¹ÎºÏŒ", "Î“Ï…ÏˆÎ¿Ï‡ÏÏÎ¹",
        "Î”Î±Î¼Î¹Î±Î½ÏŒ", "Î”Î¬Ï†Î½Î·", "Î”ÏÎ¿ÏƒÎµÏÏŒ", "Î”Ï…Ï„Î¹ÎºÏŒ", "Î”Ï‰ÏÎ¿Î¸Î­Î±",
        "ÎˆÎ´ÎµÏƒÏƒÎ±", "Î•ÎºÎºÎ»Î·ÏƒÎ¹Î¿Ï‡ÏÏÎ¹", "Î•Î»ÎµÏ…Î¸ÎµÏÎ¿Ï‡ÏÏÎ¹", "Î•Î¾Î±Ï€Î»Î¬Ï„Î±Î½Î¿Ï‚", "Î•Ï€Î¹ÏƒÎºÎ¿Ï€Î®", "Î•ÏƒÏ‰Î²Î¬Î»Ï„Î±",
        "Î–Î­ÏÎ²Î·",
        "Î˜ÎµÎ¿Î´Ï‰ÏÎ¬ÎºÎ¹", "Î˜Î·ÏÎ¹ÏŒÏ€ÎµÏ„ÏÎ±",
        "ÎŠÎ´Î±",
        "ÎšÎ±Î¹ÏƒÎ±ÏÎ¹Î±Î½Î¬", "ÎšÎ±Î»Î®", "ÎšÎ±Î»Î»Î¯Ï€Î¿Î»Î·", "ÎšÎ±Î»ÏÎ²Î¹Î±", "ÎšÎ±ÏÏ…Î´Î¹Î¬", "ÎšÎ¬Ï„Ï‰ Î“ÏÎ±Î¼Î¼Î±Ï„Î¹ÎºÏŒ", "ÎšÎµÏÎ±ÏƒÎ¹Î¬", "ÎšÎ»ÎµÎ¹ÏƒÎ¿Ï‡ÏÏÎ¹", "ÎšÎ½Î¹Î´Î®", "ÎšÎ¿ÏÏ‰Î½Î¯Î´Î±", "ÎšÎ¿Ï…Ï†Î¬Î»Î¹Î±", "ÎšÏÎ±Î½Î­Î±", "ÎšÏÏÎ± Î’ÏÏÏƒÎ·", "ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î±",
        "Î›Î¬ÎºÎºÎ±", "Î›ÎµÏ€Ï„Î¿ÎºÎ±ÏÏ…Î¬", "Î›Î¹Ï€Î±ÏÏŒ", "Î›Î¹Ï€Î¿Ï‡ÏÏÎ¹", "Î›Î¿Ï…Ï„ÏÎ¬ÎºÎ¹", "Î›Î¿Ï…Ï„ÏÎ¿Ï‡ÏÏÎ¹", "Î›ÏÎºÎ¿Î¹", "Î›Ï…ÎºÏŒÏƒÏ„Î¿Î¼Î¿",
        "ÎœÎ±Î½Î´Î±Î»ÏŒ", "ÎœÎ¬Î½Î´Î±Î»Î¿", "ÎœÎ±ÏÎ³Î±ÏÎ¯Ï„Î±", "ÎœÎ±Ï…ÏÎ¿Î²Î¿ÏÎ½Î¹", "ÎœÎµÎ³Î±Ï€Î»Î¬Ï„Î±Î½Î¿Ï‚", "ÎœÎµÏƒÎ·Î¼Î­ÏÎ¹", "ÎœÎ·Î»Î¹Î¬", "ÎœÎ¿Î½Î±ÏƒÏ„Î·ÏÎ¬ÎºÎ¹", "ÎœÏ…Î»ÏŒÏ„Î¿Ï€Î¿Ï‚",
        "ÎÎ­Î± Î–Ï‰Î®", "ÎÎ­Î± Î Î­Î»Î»Î±", "ÎÎ­Î¿Ï‚ ÎœÏ…Î»ÏŒÏ„Î¿Ï€Î¿Ï‚", "ÎÎµÎ¿Ï‡ÏÏÎ¹", "ÎÎ·ÏƒÎ¯", "ÎÏŒÏ„Î¹Î±", "ÎÏ„Î±Î¼Î¹Î±Î½ÏŒ",
        "ÎÎ¹Ï†Î¹Î±Î½Î®",
        "ÎŒÏÎ¼Î±",
        "Î Î±Î»Î±Î¹ÏŒÏ†Ï…Ï„Î¿", "Î Î±Î½Î±Î³Î¯Ï„ÏƒÎ±", "Î Î±ÏÎ±Î»Î¯Î¼Î½Î·", "Î Î­Î»Î»Î±", "Î ÎµÎ½Ï„Î±Ï€Î»Î¬Ï„Î±Î½Î¿Ï‚", "Î ÎµÏÎ±Î¯Î±", "Î ÎµÏÎ¯ÎºÎ»ÎµÎ¹Î±", "Î ÎµÏÎºÏ‰Ï„Î¿", "Î Î»Î±Ï„Î¬Î½Î·", "Î Î¿Î»Ï…ÎºÎ¬ÏÏ€Î·", "Î Î¿Î»ÏÏ€ÎµÏ„ÏÎ¿", "Î ÏÏŒÎ´ÏÎ¿Î¼Î¿Ï‚", "Î ÏÎ¿Î¼Î±Ï‡Î¿Î¯", "Î ÏÎ¿Ï†Î®Ï„Î·Ï‚ Î—Î»Î¯Î±Ï‚",
        "Î¡Î±Ï‡ÏÎ½Î±", "Î¡Î¹Î¶Î¬ÏÎ¹", "Î¡Î¹Î¶ÏŒ", "Î¡Î¿Î´Î¿Ï‡ÏÏÎ¹",
        "Î£Î±ÏÎ±ÎºÎ·Î½Î¿Î¯", "Î£ÎµÎ²Î±ÏƒÏ„Î¹Î±Î½Î¬", "Î£ÎºÏÎ´ÏÎ±", "Î£Ï„Î±Ï…ÏÎ¿Î´ÏÏŒÎ¼Î¹", "Î£Ï‰ÏƒÎ¬Î½Î´ÏÎ±",
        "Î¤ÏƒÎ¬ÎºÎ¿Î¹", "Î¤ÏƒÎ¬ÎºÏ‰Î½ÎµÏ‚",
        "Î¥Î´ÏÎ±Î¯Î±",
        "Î¦Î»Î±Î¼Î¿Ï…ÏÎ¹Î¬", "Î¦Î¿ÏÏƒÏ„Î±Î½Î·", "Î¦Ï…Ï„ÎµÎ¹Î¬",
        "Î§ÏÏ…ÏƒÎ®",
        "Î¨Ï‰Î¼Î¿Ï„ÏŒÏ€Î¹"
    ];

    // Initialize Select2 (Dropdowns Î¼Îµ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·)
    $(document).ready(function() {
        // Î“Î­Î¼Î¹ÏƒÎ¼Î± Î»Î¹ÏƒÏ„ÏÎ½ Ï‡Ï‰ÏÎ¹ÏÎ½
        const villageOptions = PELLA_VILLAGES.sort().map(v => `<option value="${v}">${v}</option>`).join("");
        $('.village-select').append(villageOptions);

        // Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Select2
        $('.select2-search').select2({ width: '100%', placeholder: "Î•Ï€Î¹Î»Î­Î¾Ï„Îµ..." });
    });

    const DOM = {
        title: document.getElementById("formTitle"),
        name: document.getElementById("nameInput"),
        address: document.getElementById("addressInput"),
        mobile: document.getElementById("mobileInput"),
        landline: document.getElementById("landlineInput"),
        email: document.getElementById("emailInput"),
        notes: document.getElementById("notesInput"),
        specialtyText: document.getElementById("specialtyText"),
        submitBtn: document.getElementById("submitBtn"),
        cancelBtn: document.getElementById("cancelBtn"),
        btnEnrich: document.getElementById("btnEnrich"),
        btnMap: document.getElementById("btnMapSearch"),
        listContainer: document.getElementById("doctorsListContainer"),
        loader: document.getElementById("doctorsListLoader"),
        publicCheck: document.getElementById("publicSectorCheck"),
        publicFields: document.getElementById("publicSectorFields"),
        affiliation: document.getElementById("affiliationInput"), // Î Î»Î­Î¿Î½ ÎµÎ¯Î½Î±Î¹ Select
        villages: {
            mon: document.getElementById("villageMon"),
            tue: document.getElementById("villageTue"),
            wed: document.getElementById("villageWed"),
            thu: document.getElementById("villageThu"),
            fri: document.getElementById("villageFri")
        }
    };

    DOM.publicCheck.addEventListener("change", function() {
        DOM.publicFields.style.display = this.checked ? "block" : "none";
    });

    // 1. SAVE / UPDATE
    DOM.submitBtn.addEventListener("click", function() {
        const name = DOM.name.value.trim();
        if (!name) return alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ ÏŒÎ½Î¿Î¼Î±.");

        let specialty = "";
        const selRadio = document.querySelector('input[name="specialty"]:checked');
        if (selRadio) specialty = (selRadio.value === "Î†Î»Î»Î¿") ? DOM.specialtyText.value : selRadio.value;

        // Î£Ï…Î»Î»Î¿Î³Î® Ï„Î¹Î¼ÏÎ½ Î±Ï€ÏŒ Ï„Î± Select2 (jQuery value)
        const villageSchedule = {
            Mon: $(DOM.villages.mon).val(),
            Tue: $(DOM.villages.tue).val(),
            Wed: $(DOM.villages.wed).val(),
            Thu: $(DOM.villages.thu).val(),
            Fri: $(DOM.villages.fri).val()
        };

        const doctorData = {
            id: editingId || Date.now(), 
            name: name,
            address: DOM.address.value,
            mobile: DOM.mobile.value,
            landline: DOM.landline.value,
            email: DOM.email.value,
            specialties: [specialty].filter(Boolean),
            notes: DOM.notes.value,
            affiliation: DOM.publicCheck.checked ? $(DOM.affiliation).val() : "",
            villageSchedule: DOM.publicCheck.checked ? villageSchedule : {}
        };

        const originalText = this.innerText;
        this.innerText = "â³ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...";
        this.disabled = true;

        fetch(SCRIPT_URL, {
            method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ doctors: [doctorData] }) 
        })
        .then(() => {
            alert(editingId ? "âœ… Î•Î½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ!" : "âœ… Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!");
            resetEditing();
            this.innerText = originalText; this.disabled = false;
            loadDoctors();
        })
        .catch(err => {
            console.error(err); alert("âŒ Î£Ï†Î¬Î»Î¼Î±.");
            this.innerText = originalText; this.disabled = false;
        });
    });

    // 2. LOAD DOCTORS
    function loadDoctors() {
        DOM.loader.style.display = "block"; DOM.listContainer.innerHTML = "";
        fetch(SCRIPT_URL).then(res => res.json()).then(data => {
            DOM.loader.style.display = "none";
            if (!data || data.length === 0) { DOM.listContainer.innerHTML = "<p style='text-align:center; color:#999;'>ÎšÎµÎ½Î® Î»Î¯ÏƒÏ„Î±.</p>"; return; }
            
            data.forEach(doc => {
                const card = document.createElement("div"); card.className = "doctor-card";
                const spec = (doc.specialties && doc.specialties.length) ? doc.specialties.join(", ") : "Î§Ï‰ÏÎ¯Ï‚ ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±";
                const phones = [doc.mobile, doc.landline].filter(Boolean).join(" â€¢ ");
                
                let publicInfo = "";
                if(doc.affiliation) publicInfo += `<p style="color:#e67e22; font-weight:bold;"><i class="fas fa-hospital"></i> ${doc.affiliation}</p>`;
                if(doc.villageSchedule && Object.values(doc.villageSchedule).some(v=>v)) {
                   // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ¬
                   const days = [];
                   if(doc.villageSchedule.Mon) days.push("Î”ÎµÏ…: "+doc.villageSchedule.Mon);
                   if(doc.villageSchedule.Tue) days.push("Î¤ÏÎ¹: "+doc.villageSchedule.Tue);
                   if(doc.villageSchedule.Wed) days.push("Î¤ÎµÏ„: "+doc.villageSchedule.Wed);
                   if(doc.villageSchedule.Thu) days.push("Î ÎµÎ¼: "+doc.villageSchedule.Thu);
                   if(doc.villageSchedule.Fri) days.push("Î Î±Ï: "+doc.villageSchedule.Fri);
                   publicInfo += `<p style="font-size:12px; color:#555; margin-top:2px;"><i>${days.join(" | ")}</i></p>`;
                }

                const mapQuery = encodeURIComponent((doc.address || "") + " " + doc.name);
                const mapUrl = `https://www.google.com/maps/search/?api=1&query=${mapQuery}`;

                card.innerHTML = `
                    <button class="edit-btn" title="Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±"><i class="fas fa-pencil-alt"></i></button>
                    <div class="doc-header"><h3>${doc.name}</h3><span class="doc-spec">${spec}</span></div>
                    <div class="doc-details">
                        ${publicInfo}
                        <p><a href="${mapUrl}" target="_blank" class="map-link"><i class="fas fa-map-marker-alt"></i> ${doc.address || "Î§Ï‰ÏÎ¯Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·"}</a></p>
                        <p><i class="fas fa-phone"></i> ${phones || "-"}</p>
                    </div>
                `;
                card.querySelector(".edit-btn").addEventListener("click", () => editDoctor(doc));
                DOM.listContainer.appendChild(card);
            });
        }).catch(() => { DOM.loader.style.display = "none"; DOM.listContainer.innerHTML = "<p>Î£Ï†Î¬Î»Î¼Î±.</p>"; });
    }

    // 3. EDIT
    function editDoctor(doc) {
        editingId = doc.id;
        DOM.title.innerHTML = `<i class="fas fa-edit"></i> Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±: ${doc.name}`;
        DOM.submitBtn.innerText = "Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î™Î±Ï„ÏÎ¿Ï"; DOM.submitBtn.style.backgroundColor = "#e67e22";
        DOM.cancelBtn.style.display = "block";

        DOM.name.value = doc.name || ""; DOM.address.value = doc.address || "";
        DOM.mobile.value = doc.mobile || ""; DOM.landline.value = doc.landline || "";
        DOM.email.value = doc.email || ""; DOM.notes.value = doc.notes || "";

        const spec = (doc.specialties && doc.specialties.length) ? doc.specialties[0] : "";
        const radio = document.querySelector(`input[name="specialty"][value="${spec}"]`);
        if (radio) { radio.checked = true; DOM.specialtyText.style.display = "none"; } 
        else if (spec) { document.getElementById("radioOther").checked = true; DOM.specialtyText.value = spec; DOM.specialtyText.style.display = "block"; }

        if (doc.affiliation || (doc.villageSchedule && Object.values(doc.villageSchedule).some(v=>v))) {
            DOM.publicCheck.checked = true; DOM.publicFields.style.display = "block";
            // Set Select2 values
            $(DOM.affiliation).val(doc.affiliation).trigger('change');
            if (doc.villageSchedule) {
                $(DOM.villages.mon).val(doc.villageSchedule.Mon).trigger('change');
                $(DOM.villages.tue).val(doc.villageSchedule.Tue).trigger('change');
                $(DOM.villages.wed).val(doc.villageSchedule.Wed).trigger('change');
                $(DOM.villages.thu).val(doc.villageSchedule.Thu).trigger('change');
                $(DOM.villages.fri).val(doc.villageSchedule.Fri).trigger('change');
            }
        } else {
            DOM.publicCheck.checked = false; DOM.publicFields.style.display = "none";
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function resetEditing() {
        editingId = null;
        DOM.name.value = ""; DOM.address.value = ""; DOM.mobile.value = ""; DOM.landline.value = ""; DOM.email.value = ""; DOM.notes.value = ""; DOM.specialtyText.value = "";
        
        // Reset Select2s
        $(DOM.affiliation).val("").trigger('change');
        $('.village-select').val("").trigger('change');
        
        DOM.publicCheck.checked = false; DOM.publicFields.style.display = "none";
        document.querySelectorAll('input[name="specialty"]').forEach(r => r.checked = false);
        DOM.title.innerHTML = `<i class="fas fa-user-md"></i> ÎÎ­Î¿Ï‚ Î™Î±Ï„ÏÏŒÏ‚`;
        DOM.submitBtn.innerText = "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î™Î±Ï„ÏÎ¿Ï"; DOM.submitBtn.style.backgroundColor = "#34a853";
        DOM.cancelBtn.style.display = "none";
    }

    // --- Helpers (Autocomplete, Enrich, Map) ---
    // (ÎŸ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Î³Î¹Î± autocomplete Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Î¯Î´Î¹Î¿Ï‚)
    let timeoutId = null; const listDiv = document.createElement("div"); listDiv.id = "suggestions-list"; DOM.name.parentNode.appendChild(listDiv);
    DOM.name.addEventListener("input", function() {
        const query = this.value.trim(); if (query.length < 2) { listDiv.style.display = "none"; return; }
        clearTimeout(timeoutId); timeoutId = setTimeout(() => {
            fetch(`${SCRIPT_URL}?action=searchContacts&query=${encodeURIComponent(query)}`).then(res=>res.json()).then(renderSuggestions);
        }, 300);
    });
    DOM.btnEnrich.addEventListener("click", function() {
        const query = DOM.name.value.trim() || DOM.mobile.value.trim(); if (!query) return alert("Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ½Î¿Î¼Î±.");
        toggleLoading(this, true);
        fetch(`${SCRIPT_URL}?action=enrich&query=${encodeURIComponent(query)}`).then(res=>res.json()).then(data => {
            toggleLoading(this, false); if (data.found) fillForm(data); else alert("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ÎµÏ€Î±Ï†Î®.");
        });
    });
    DOM.btnMap.addEventListener("click", function() {
        const name = DOM.name.value.trim(); if (!name) return alert("Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ½Î¿Î¼Î±.");
        let spec = ""; const s = document.querySelector('input[name="specialty"]:checked'); if(s) spec = (s.value === "Î†Î»Î»Î¿") ? DOM.specialtyText.value : s.value;
        const query = name + " " + spec; toggleLoading(this, true);
        fetch(`${SCRIPT_URL}?action=getAddress&query=${encodeURIComponent(query)}`).then(res=>res.json()).then(data => {
            toggleLoading(this, false); if(data.found && data.address) DOM.address.value = data.address; else alert("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ.");
        });
    });
    function renderSuggestions(list) {
        listDiv.innerHTML = ""; if(!list || !list.length) { listDiv.style.display = "none"; return; }
        list.forEach(p => { const div = document.createElement("div"); div.className = "suggestion-item"; div.innerHTML = `<b>${p.name}</b><br><small>${p.specialty||""}</small>`; div.addEventListener("click", ()=>{ fillForm(p); listDiv.style.display = "none"; }); listDiv.appendChild(div); });
        listDiv.style.display = "block";
    }
    function fillForm(data) {
        if(data.name) DOM.name.value = data.name; if(data.address) DOM.address.value = data.address; if(data.mobile) DOM.mobile.value = data.mobile; if(data.landline) DOM.landline.value = data.landline; if(data.email) DOM.email.value = data.email; if(data.notes) DOM.notes.value = data.notes;
        if (data.specialty) {
            const radio = document.querySelector(`input[name="specialty"][value="${data.specialty}"]`);
            if (radio) { radio.checked = true; DOM.specialtyText.style.display = "none"; } else { document.getElementById("radioOther").checked = true; DOM.specialtyText.value = data.specialty; DOM.specialtyText.style.display = "block"; }
        }
    }
    function toggleLoading(btn, isLoading) { if(isLoading) { btn.dataset.html = btn.innerHTML; btn.innerHTML = '<i class="fas fa-spinner"></i>'; btn.disabled = true; } else { btn.innerHTML = btn.dataset.html; btn.disabled = false; } }
    document.querySelectorAll('input[name="specialty"]').forEach(r => { r.addEventListener('change', (e) => DOM.specialtyText.style.display = (e.target.value === "Î†Î»Î»Î¿") ? "block" : "none"); });
    document.addEventListener("click", (e) => { if (!DOM.name.contains(e.target) && !listDiv.contains(e.target)) listDiv.style.display = "none"; });

    window.addEventListener("DOMContentLoaded", loadDoctors);
</script>
</body>
</html>
