<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Data App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Î“Î•ÎÎ™ÎšÎŸ Î£Î¤Î¥Î› --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .main-container { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; margin-bottom: 30px; }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 25px; }

        /* --- Î¦ÎŸÎ¡ÎœÎ‘ --- */
        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input[type="text"], input[type="email"] { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; box-sizing: border-box; transition: 0.3s; }
        input:focus { border-color: #1a73e8; outline: none; }
        .input-group-container { display: flex; gap: 10px; }
        .input-wrapper { flex: 1; position: relative; }

        /* ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ Î•ÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ */
        .btn-tool { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; flex-shrink: 0; transition: 0.2s; }
        .btn-enrich { background-color: #1a73e8; } .btn-enrich:hover { background-color: #155db5; }
        .btn-map { background-color: #ea4335; } .btn-map:hover { background-color: #c5221f; }
        
        /* Autocomplete List */
        #suggestions-list { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e0e0e0; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .suggestion-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .suggestion-item:hover { background: #f5faff; }
        
        /* Radio Buttons (Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„ÎµÏ‚) */
        .specialty-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px; }
        .radio-label { display: flex; align-items: center; cursor: pointer; font-size: 13px; background: #f8f9fa; padding: 8px 12px; border-radius: 20px; border: 1px solid #dee2e6; transition: background 0.2s; }
        .radio-label:hover { background: #e9ecef; }
        input[type="radio"]:checked + span { font-weight: bold; color: #1a73e8; }
        input[type="radio"] { margin-right: 8px; }

        /* ÎšÎ¿Ï…Î¼Ï€Î¯ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚ */
        .btn-submit { width: 100%; padding: 14px; background-color: #34a853; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .btn-submit:hover { background-color: #2c8f45; }
        .btn-submit:disabled { background-color: #ccc; cursor: not-allowed; }

        /* --- Î›Î™Î£Î¤Î‘ Î™Î‘Î¤Î¡Î©Î (DATABASE VIEW) --- */
        .db-container { width: 100%; max-width: 600px; margin-top: 20px; }
        .doctor-card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid #1a73e8; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .doc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .doc-header h3 { margin: 0; font-size: 16px; color: #333; }
        .doc-spec { font-size: 13px; background: #e8f0fe; color: #1a73e8; padding: 2px 8px; border-radius: 10px; font-weight: 600; }
        .doc-details p { margin: 3px 0; font-size: 14px; color: #555; }
        .doc-details i { width: 20px; color: #888; text-align: center; }
        
        .refresh-btn { background: none; border: none; color: #1a73e8; cursor: pointer; font-weight: bold; margin-bottom: 10px; float: right; }
        
        /* Spinner */
        .fa-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="main-container">
    <h2><i class="fas fa-user-md"></i> ÎÎ­Î¿Ï‚ Î™Î±Ï„ÏÏŒÏ‚</h2>

    <div class="form-group">
        <label>ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿</label>
        <div class="input-group-container">
            <div class="input-wrapper">
                <input type="text" id="nameInput" placeholder="Ï€.Ï‡. Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚ Î“ÎµÏÏÎ³Î¹Î¿Ï‚" autocomplete="off">
            </div>
            <button id="btnEnrich" class="btn-tool btn-enrich" title="Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· Î±Ï€ÏŒ Î•Ï€Î±Ï†Î­Ï‚"><i class="fas fa-cloud-download-alt"></i></button>
        </div>
    </div>

    <div class="form-group">
        <label>Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Î™Î±Ï„ÏÎµÎ¯Î¿Ï…</label>
        <div class="input-group-container">
            <div class="input-wrapper">
                <input type="text" id="addressInput" placeholder="ÎŸÎ´ÏŒÏ‚, Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚, Î ÎµÏÎ¹Î¿Ï‡Î®">
            </div>
            <button id="btnMapSearch" class="btn-tool btn-map" title="Î•ÏÏÎµÏƒÎ· Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ ÏƒÏ„Î¿ Google Maps"><i class="fas fa-map-marker-alt"></i></button>
        </div>
    </div>

    <div class="input-group-container form-group">
        <div class="input-wrapper">
            <label>ÎšÎ¹Î½Î·Ï„ÏŒ</label>
            <input type="text" id="mobileInput" placeholder="69...">
        </div>
        <div class="input-wrapper">
            <label>Î£Ï„Î±Î¸ÎµÏÏŒ</label>
            <input type="text" id="landlineInput" placeholder="210...">
        </div>
    </div>

    <div class="form-group">
        <label>Email</label>
        <input type="email" id="emailInput">
    </div>

    <div class="form-group">
        <label>Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±</label>
        <div class="specialty-container">
            <label class="radio-label"><input type="radio" name="specialty" value="Î“ÎµÎ½Î¹ÎºÏŒÏ‚ Î™Î±Ï„ÏÏŒÏ‚"> <span>Î“ÎµÎ½Î¹ÎºÏŒÏ‚ Î™Î±Ï„ÏÏŒÏ‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="ÎšÎ±ÏÎ´Î¹Î¿Î»ÏŒÎ³Î¿Ï‚"> <span>ÎšÎ±ÏÎ´Î¹Î¿Î»ÏŒÎ³Î¿Ï‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î“ÎµÎ½. Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³ÏŒÏ‚"> <span>Î“ÎµÎ½. Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³ÏŒÏ‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î‘Î³Î³ÎµÎ¹Î¿Î»ÏŒÎ³Î¿Ï‚ /Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³ÏŒÏ‚"> <span>Î‘Î³Î³ÎµÎ¹Î¿Î»ÏŒÎ³Î¿Ï‚ /Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³ÏŒÏ‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î Î½ÎµÏ…Î¼Î¿Î½Î¿Î»ÏŒÎ³Î¿Ï‚"> <span>Î Î½ÎµÏ…Î¼Î¿Î½Î¿Î»ÏŒÎ³Î¿Ï‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î Î±Î¸Î¿Î»ÏŒÎ³Î¿Ï‚"> <span>Î Î±Î¸Î¿Î»ÏŒÎ³Î¿Ï‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="ÎŸÏÎ¸Î¿Ï€ÎµÎ´Î¹ÎºÏŒÏ‚"> <span>ÎŸÏÎ¸Î¿Ï€ÎµÎ´Î¹ÎºÏŒÏ‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î“Ï…Î½Î±Î¹ÎºÎ¿Î»ÏŒÎ³Î¿Ï‚"> <span>Î“Ï…Î½Î±Î¹ÎºÎ¿Î»ÏŒÎ³Î¿Ï‚</span></label>
            <label class="radio-label"><input type="radio" name="specialty" value="Î†Î»Î»Î¿" id="radioOther"> <span>Î†Î»Î»Î¿</span></label>
        </div>
        <input type="text" id="specialtyText" placeholder="Î“ÏÎ¬ÏˆÏ„Îµ Ï„Î·Î½ ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±..." style="margin-top:10px; display:none; width:100%;">
    </div>

    <input type="hidden" id="notesInput"> <button class="btn-submit" id="submitBtn">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î™Î±Ï„ÏÎ¿Ï</button>
</div>

<div class="db-container">
    <div style="overflow: hidden; margin-bottom: 10px;">
        <h3 style="float:left; margin:0;">ğŸ—‚ï¸ Î’Î¬ÏƒÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</h3>
        <button class="refresh-btn" onclick="loadDoctors()">ğŸ”„ Î‘Î½Î±Î½Î­Ï‰ÏƒÎ·</button>
    </div>
    <div id="doctorsListLoader" style="display:none; text-align:center; padding:20px;"><i class="fas fa-spinner fa-2x"></i></div>
    <div id="doctorsListContainer">
        </div>
</div>

<script>
    // --- Î¡Î¥Î˜ÎœÎ™Î£Î— URL (Î’ÎµÎ²Î±Î¹ÏÏƒÎ¿Ï… ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ) ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx_WDKl8szlAPfnchH_1dlBSbFn_EFYcZiHVWTYglciGpH4IzhnBXau9GdLy6Ivuly-/exec";

    // DOM Elements
    const DOM = {
        name: document.getElementById("nameInput"),
        address: document.getElementById("addressInput"),
        mobile: document.getElementById("mobileInput"),
        landline: document.getElementById("landlineInput"),
        email: document.getElementById("emailInput"),
        notes: document.getElementById("notesInput"),
        specialtyText: document.getElementById("specialtyText"),
        submitBtn: document.getElementById("submitBtn"),
        btnEnrich: document.getElementById("btnEnrich"),
        btnMap: document.getElementById("btnMapSearch"),
        listContainer: document.getElementById("doctorsListContainer"),
        loader: document.getElementById("doctorsListLoader")
    };

    // --- 1. Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î— Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î (POST) ---
    DOM.submitBtn.addEventListener("click", function() {
        // Î£Ï…Î»Î»Î¿Î³Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
        const name = DOM.name.value.trim();
        if (!name) return alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Ï„Î¿ ÏŒÎ½Î¿Î¼Î±.");

        let specialty = "";
        const selRadio = document.querySelector('input[name="specialty"]:checked');
        if (selRadio) specialty = (selRadio.value === "Î†Î»Î»Î¿") ? DOM.specialtyText.value : selRadio.value;

        // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î¹Î±Ï„ÏÎ¿Ï
        const doctorData = {
            id: Date.now(), 
            name: name,
            address: DOM.address.value,
            mobile: DOM.mobile.value,
            landline: DOM.landline.value,
            email: DOM.email.value,
            specialties: [specialty].filter(Boolean),
            notes: DOM.notes.value
        };

        // UI Feedback
        const originalText = this.innerText;
        this.innerText = "â³ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...";
        this.disabled = true;

        // Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ÏƒÏ„Î¿ Script
        fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors", 
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ doctors: [doctorData] }) 
        })
        .then(() => {
            alert("âœ… ÎŸ Î¹Î±Ï„ÏÏŒÏ‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!");
            clearForm();
            this.innerText = originalText;
            this.disabled = false;
            loadDoctors(); // Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· Î»Î¯ÏƒÏ„Î±Ï‚
        })
        .catch(err => {
            console.error(err);
            alert("âŒ Î£Ï†Î¬Î»Î¼Î± Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚.");
            this.innerText = originalText;
            this.disabled = false;
        });
    });

    // --- 2. Î¦ÎŸÎ¡Î¤Î©Î£Î— Î›Î™Î£Î¤Î‘Î£ Î™Î‘Î¤Î¡Î©Î (GET) ---
    function loadDoctors() {
        DOM.loader.style.display = "block";
        DOM.listContainer.innerHTML = "";

        fetch(SCRIPT_URL) 
            .then(res => res.json())
            .then(data => {
                DOM.loader.style.display = "none";
                if (!data || data.length === 0) {
                    DOM.listContainer.innerHTML = "<p style='text-align:center; color:#999;'>ÎšÎ±Î½Î­Î½Î±Ï‚ Î¹Î±Ï„ÏÏŒÏ‚.</p>";
                    return;
                }
                
                // Render List
                data.forEach(doc => {
                    const card = document.createElement("div");
                    card.className = "doctor-card";
                    
                    const spec = (doc.specialties && doc.specialties.length) ? doc.specialties.join(", ") : "Î§Ï‰ÏÎ¯Ï‚ ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±";
                    const phones = [doc.mobile, doc.landline].filter(Boolean).join(" â€¢ ");
                    
                    card.innerHTML = `
                        <div class="doc-header">
                            <h3>${doc.name}</h3>
                            <span class="doc-spec">${spec}</span>
                        </div>
                        <div class="doc-details">
                            <p><i class="fas fa-map-marker-alt"></i> ${doc.address || "-"}</p>
                            <p><i class="fas fa-phone"></i> ${phones || "-"}</p>
                        </div>
                    `;
                    DOM.listContainer.appendChild(card);
                });
            })
            .catch(err => {
                DOM.loader.style.display = "none";
                DOM.listContainer.innerHTML = "<p style='color:red; text-align:center;'>Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î»Î¯ÏƒÏ„Î±Ï‚.</p>";
            });
    }

    // --- 3. Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î•Î£ (Autocomplete, Enrich, Map) ---
    
    // Autocomplete Setup
    let timeoutId = null;
    const listDiv = document.createElement("div");
    listDiv.id = "suggestions-list";
    DOM.name.parentNode.appendChild(listDiv);

    // Event: Autocomplete Typing
    DOM.name.addEventListener("input", function() {
        const query = this.value.trim();
        if (query.length < 2) { listDiv.style.display = "none"; return; }
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            fetch(`${SCRIPT_URL}?action=searchContacts&query=${encodeURIComponent(query)}`)
                .then(res => res.json()).then(renderSuggestions).catch(console.error);
        }, 300);
    });

    // Event: Enrich (Blue Button) - Î¨Î¬Ï‡Î½ÎµÎ¹ ÏƒÏ„Î¹Ï‚ ÎµÏ€Î±Ï†Î­Ï‚
    DOM.btnEnrich.addEventListener("click", function() {
        const query = DOM.name.value.trim() || DOM.mobile.value.trim();
        if (!query) return alert("Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ½Î¿Î¼Î±.");
        toggleLoading(this, true);
        fetch(`${SCRIPT_URL}?action=enrich&query=${encodeURIComponent(query)}`)
            .then(res => res.json()).then(data => {
                toggleLoading(this, false);
                if (data.found) fillForm(data); else alert("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ÎµÏ€Î±Ï†Î®.");
            }).catch(() => { toggleLoading(this, false); alert("Error."); });
    });

    // Event: MAP BUTTON (Î•Î Î™Î£Î¤Î¡ÎŸÎ¦Î— Î£Î¤ÎŸ Î‘ÎÎŸÎ™Î“ÎœÎ‘ TAB)
    DOM.btnMap.addEventListener("click", function() {
        const name = DOM.name.value.trim();
        if (!name) return alert("Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ½Î¿Î¼Î±.");
        
        let spec = "";
        const s = document.querySelector('input[name="specialty"]:checked');
        if(s) spec = (s.value === "Î†Î»Î»Î¿") ? DOM.specialtyText.value : s.value;

        // Î¦Ï„Î¹Î¬Ï‡Î½Î¿Ï…Î¼Îµ Link Î³Î¹Î± Google Maps Search
        const searchTerm = name + " " + spec + " Î¹Î±Ï„ÏÎµÎ¯Î¿";
        const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(searchTerm)}`;
        
        // Î‘Î½Î¿Î¯Î³Î¿Ï…Î¼Îµ ÏƒÎµ Î½Î­Î± ÎºÎ±ÏÏ„Î­Î»Î±
        window.open(mapUrl, '_blank');
    });

    // Helpers
    function renderSuggestions(list) {
        listDiv.innerHTML = "";
        if(!list || !list.length) { listDiv.style.display = "none"; return; }
        list.forEach(p => {
            const div = document.createElement("div");
            div.className = "suggestion-item";
            div.innerHTML = `<b>${p.name}</b><br><small>${p.specialty || ""} ${p.mobile || ""}</small>`;
            div.addEventListener("click", () => { fillForm(p); listDiv.style.display = "none"; });
            listDiv.appendChild(div);
        });
        listDiv.style.display = "block";
    }

    function fillForm(data) {
        if(data.name) DOM.name.value = data.name;
        if(data.address) DOM.address.value = data.address;
        if(data.mobile) DOM.mobile.value = data.mobile;
        if(data.landline) DOM.landline.value = data.landline;
        if(data.email) DOM.email.value = data.email;
        if(data.notes) DOM.notes.value = data.notes;
        
        if (data.specialty) {
            const radio = document.querySelector(`input[name="specialty"][value="${data.specialty}"]`);
            if (radio) { 
                radio.checked = true; 
                DOM.specialtyText.style.display = "none"; 
            } else { 
                document.getElementById("radioOther").checked = true; 
                DOM.specialtyText.value = data.specialty; 
                DOM.specialtyText.style.display = "block"; 
            }
        }
    }

    function clearForm() {
        DOM.name.value = ""; DOM.address.value = ""; DOM.mobile.value = ""; 
        DOM.landline.value = ""; DOM.email.value = ""; DOM.notes.value = ""; DOM.specialtyText.value = "";
        document.querySelectorAll('input[name="specialty"]').forEach(r => r.checked = false);
    }

    function toggleLoading(btn, isLoading) {
        if(isLoading) { btn.dataset.html = btn.innerHTML; btn.innerHTML = '<i class="fas fa-spinner"></i>'; btn.disabled = true; }
        else { btn.innerHTML = btn.dataset.html; btn.disabled = false; }
    }

    document.querySelectorAll('input[name="specialty"]').forEach(r => {
        r.addEventListener('change', (e) => DOM.specialtyText.style.display = (e.target.value === "Î†Î»Î»Î¿") ? "block" : "none");
    });
    document.addEventListener("click", (e) => { if (!DOM.name.contains(e.target) && !listDiv.contains(e.target)) listDiv.style.display = "none"; });

    // Î•ÎºÎºÎ¯Î½Î·ÏƒÎ·: Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î»Î¯ÏƒÏ„Î±Ï‚
    window.addEventListener("DOMContentLoaded", loadDoctors);
</script>

</body>
</html>
